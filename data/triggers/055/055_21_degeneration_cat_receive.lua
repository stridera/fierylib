-- Trigger: degeneration_cat_receive
-- Zone: 55, ID: 21
-- Type: MOB, Flags: RECEIVE
-- Status: NEEDS_REVIEW
--   Large script: 11930 chars
--
-- Original DG Script: #5521

-- Converted from DG Script #5521: degeneration_cat_receive
-- Original: MOB trigger, flags: RECEIVE, probability: 100%
local _return_value = true  -- Default: allow action
local stage = actor:get_quest_stage("degeneration")
if stage == 0 then
    _return_value = false
    self.room:send(tostring(self.name) .. " refuses " .. tostring(object.shortdesc) .. ".")
    self:command("hiss actor")
    wait(2)
    self:say("Who are you?  Why are you giving me this?")
elseif stage == 1 and object.id == 58008 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("book")
    self:emote("studies the book closely.")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'Hmmm, that's an unusual configuration...  The cage must have")
    self.room:send("</>been part of the secret.'")
    wait(2)
    self:emote("closes the book.")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'Yajiro was on to something, though his understanding was")
    self.room:send("</>quite rudimentary.  I need to dig a little deeper.'")
    wait(4)
    self:say("Literally and figuratively!")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'A troll sorcerer by the name of Mesmeriz has set up an")
    self.room:send("</>illusory lair in the Minithawkin Mines.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'Word among the dark practitioners is, he's trying to perform")
    self.room:send("</>the Ritual of Night and become a lich.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'Bring back the necklace he carries so I can see how much")
    self.room:send("</>progress he's made.'")
elseif stage == 2 and object.id == 37015 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("necklace")
    self.room:send(tostring(self.name) .. " utters the words, '<b:yellow>oculoinfra kariq</>'.")
    self.room:send(tostring(self.name) .. "'s eyes flash bright yellow!")
    wait(1)
    self:emote("examines " .. tostring(objects.template(370, 15).name))
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'Mesmeriz was remarkably close to his goal.  The principles")
    self.room:send("</>of energy transfer he was using were quite unique.'")
    wait(4)
    self:say("It seems all he was missing was a suitable phylactery.")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'There's another wizard who has been working in body")
    self.room:send("</>modification, but on a massive scale.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'He's enchanted the entire town of Nordus and is")
    self.room:send("</>experimenting on the villagers.  Rumor is he's trying to grow bodies as fodder")
    self.room:send("</>for mass animation.'")
    wait(5)
    self:say("I must admit, I'm impressed.")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'He has a mask made from the face of one of his many victims")
    self.room:send("</>which he uses as his focus.  It's a bit vulgar, but it should serve my")
    self.room:send("</>purposes.  Secure it and bring it back.'")
elseif stage == 3 and object.id == 51075 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("mask")
    wait(1)
    self:emote("greedily devours the " .. get_obj_noadesc("51075") .. "!")
    wait(3)
    self:command("lick")
    self:say("Nothing makes you more familiar with magic than the taste!")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'Some impressive potency to use transmutation at that scale.")
    self.room:send("</>Plus some powerful evocation.'")
    wait(4)
    self:command("burp")
    self:say("Spicy!")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'But Luchiaans wasn't a very skilled necromancer it seems.")
    self.room:send("</>Still, it gives me some ideas.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'I need something of a more demonic nature to compare notes")
    self.room:send("</>to.'")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'Cyprianum, the ruler of Demise Keep, has a particularly")
    self.room:send("</>prized servant, Voliangloch the Evil.  As a devotee of the demonic Cyprianum,")
    self.room:send("</>Voliangloch may have struck that special balance between arcane and divine.'")
    wait(7)
    self.room:send(tostring(self.name) .. " says, 'Bring me his magical focus, " .. tostring(objects.template(430, 20).name) .. ".")
    self.room:send("</>It should give me sufficient insight to Voliangloch's magic.'")
elseif stage == 4 and object.id == 43020 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("rod")
    wait(1)
    self:emote("bats " .. tostring(objects.template(430, 20).name) .. " around a bit.")
    wait(3)
    self:emote("bats " .. tostring(objects.template(430, 20).name) .. " around some more.")
    wait(5)
    self:emote("frantically swats " .. tostring(objects.template(430, 20).name) .. " around and sends it flying!")
    self:command("hiss")
    wait(3)
    self:say("Well that was most informative.")
    wait(3)
    self:say("Interesting blending technique Voliangloch employed.")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'It looks like we have to approach the big players for more")
    self.room:send("</>information now.'")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'The first of the true necromancers I need you to \"visit\" is")
    self.room:send("</>Kryzanthor.  He's created a vast necropolis near Anduin, the likes of which")
    self.room:send("</>most beings can only dream about!'")
    wait(6)
    self.room:send(tostring(self.name) .. " says, 'He wears a unique robe that I'd like to get my paws on.  Get")
    self.room:send("</>it and bring it back to me.'")
elseif stage == 5 and object.id == 47003 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("robe")
    self:emote("gingerly sniffs " .. tostring(objects.template(470, 3).name) .. ".")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'Yes, this makes more sense.  Needing a physical conduit to")
    self.room:send("</>focus the transference of energies through while simultaneously shielding the")
    self.room:send("</>body appears to be critical here.'")
    wait(6)
    self.room:send(tostring(self.name) .. " says, 'Kryzanthor had mastered suffusing the dead with animating")
    self.room:send("</>energies, but he didn't quite have the mastery of draining life force from")
    self.room:send("</>the living.'")
    wait(6)
    self:say("There is one whom I have heard does have such a power.")
    wait(3)
    self.room:send(tostring(self.name) .. " says, 'In the Iron Hills there is an ancient barrow where several")
    self.room:send("</>kings have been laid to rest.  What's more, those of us who deal in death know")
    self.room:send("</>it's the lair of one of the two known liches in the world, King Ureal.'")
    wait(7)
    self.room:send(tostring(self.name) .. " says, 'In particular, he has a statuette I'm most interested in.")
    self.room:send("</>It supposedly can drain the energy of the living.'")
    wait(5)
    self.room:send(tostring(self.name) .. " says, 'If that's true, then it would be a huge missing piece of the")
    self.room:send("</>puzzle.'")
    wait(3)
    self:say("I'm quite excited for this one, so hurry up!")
elseif stage == 6 and object.id == 48009 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("statuette")
    self:say("Well done my little one, well done.")
    self:emote("meows in gratitude.")
    wait(2)
    self:emote("repeatedly rubs up against the statuette.")
    self.room:send("The statuette begins to glow <b:green>bright green!</>")
    wait(1)
    self:say("Fascinating...")
    wait(3)
    self:say("This is definitely helpful.")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'The last person I need information from is a curmudgeonly")
    self.room:send("</>old thing, Norisent.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'He sought to raise the dead, not just in a state of undeath,")
    self.room:send("</>but to truly restore them to life.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'Unfortunately for him, his experiments failed and he turned")
    self.room:send("</>himself into a lich instead.'")
    wait(2)
    self:command("roll")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'Regardless, he's been hiding out at the Cathedral of")
    self.room:send("</>Betrayal for decades now.'")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'Find Norisent and whatever book he's keeping notes in these")
    self.room:send("</>days.  While I think I could manage this without his notes, I want to be")
    self.room:send("</>completely sure.'")
elseif stage == 8 and object.id == 8551 then
    actor.name:advance_quest("degeneration")
    wait(1)
    self:destroy_item("book")
    self:emote("flips through the pages of the book.")
    wait(2)
    self:command("gasp")
    wait(1)
    self.room:send(tostring(self.name) .. " says, 'It's a good thing I have these notes or my planned matrix")
    self.room:send("</>configuration would have completely backfired!  I'll make the necessary")
    self.room:send("</>adjustments to the final casting.'")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'The other thing these notes show me is I'm missing")
    self.room:send("</>something to channel the transferring energy through.'")
    wait(4)
    self:say("Hmmmmm...")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'The statuette is too strongly attuned to Ureal to be")
    self.room:send("</>suitable...'")
    wait(3)
    self:say("Let me see...")
    wait(3)
    self.room:send(tostring(self.name) .. " utters the words, <b:yellow>'hiqi avykamina'</>.")
    wait(4)
    self.room:send(tostring(self.name) .. " says, 'It seems there is a dangerous ruby hidden under some kind")
    self.room:send("</>of stairway?  That makes no sense.  Yet my divination indicates it would be an")
    self.room:send("</>acceptable conduit for this spell.'")
    wait(6)
    self:say("Seek it out!")
elseif stage == 9 and object.id == 12526 then
    wait(1)
    self:destroy_item("ruby")
    self.room:send(tostring(self.name) .. "'s eyes widen and gleam at the sight of the ruby!")
    self:say("Magnificent!  I've never seen anything quite like it.")
    wait(3)
    self:emote("scratches out a huge diagram in the earth inside the tent.")
    self.room:send(tostring(self.name) .. " carefully places " .. tostring(objects.template(125, 26).name) .. " in the center of the diagram.")
    wait(4)
    self.room:send(tostring(self.name) .. " utters the word, <b:yellow>'oculotunsofihuab'</>.")
    self.room:send("Waves of necrotic energy rush blast out from the diagram bolstering the forces of the Third Black Legion!")
    wait(4)
    self:command("cackle")
    self.room:send(tostring(self.name) .. " says, 'I've done it!  I've perfected the formula for Degeneration!!")
    self.room:send("</>Here, see how it works!!'")
    wait(4)
    actor:send("Looking at the notes, you understand what " .. tostring(self.name) .. " has done.")
    actor:send("<b:white>You have learned &9Degeneration<white>!</>")
    skills.set_level(actor.name, "degeneration", 100)
    actor.name:complete_quest("degeneration")
else
    _return_value = false
    self:command("hiss " .. tostring(actor))
    self.room:send(tostring(self.name) .. " refuses " .. tostring(object.shortdesc) .. ".")
    wait(2)
    self.room:send(tostring(self.name) .. " says, 'This isn't what I asked for. What are you, stupid?")
    self.room:send("</>Do you need me to remind you of your <b:white>[spell progress]</>?'")
end
return _return_value